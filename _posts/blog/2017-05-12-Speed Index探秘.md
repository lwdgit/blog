---
title: Speed Index探秘
---

在做性能优化的时候，一直有一个问题萦绕在我心头。虽然目前有很多参数可以度量一个网页的加载性能，却没有什么指标去衡量用户的真实感受。

过去我们经常使用页面的加载时间来衡量一个页面的加载速度。最常用的方法就是计算页面的onload时间。这个时间很容易测试，然而，它却不是能很好地展示一个用户的真实体验。因为我们可以很简单地利用后置加载来绕过个时间，把onload时间缩短，这样做的问题就是虽然浏览器检测已经加载完了，但是页面迟迟没有展现给用户（比如一些h5的小游戏），这带给用户的体验依旧是很差的。所以我们需要一个更精准的手段来衡量一个页面的好坏。

关于Speed Index是什么，我们先直接上一张图直观感受一下。

![](https://sites.google.com/a/webpagetest.org/docs/_/rsrc/1472780187203/using-webpagetest/metrics/speed-index/chart-index-b-small.png)

横轴表示时间，纵轴表示加载完成率，用100%表示。Speed Index就是上图深色区域。

根据官方定义, SpeedIndex表示的是一个页面的可见部分展示的平均时间。计算依据是页面的加载时间和页面的视窗大小。用公式表示就是：轮询得分 = 轮询间隔(一般为100ms) * (1.0 - 页面完成度/100)。最终的得分由轮询得分求和得出也，就是SUM(轮询得分)。

根据公式我们可以看出，当一个页首屏展示的越多，时间越短，则Speed Index越小。所以一个理想的网页其Speed Index为0。

目前支持Speed Index的平台不多，WebpageTest是其中的佼佼者。



既然我们知道了其原理，那又可以通过哪些手段去做优化呢？

根据Yohoo早年及Google权威的分析调查，我们现在可以用的策略有以下几个：

1. 尽可能减少资源请求数及首屏资源大小
2. 首屏资源可以考虑内联（最极端的方式如Google首页那样，全部内联到页面），关于为什么内联性能会好，点击查看[优化关键渲染路径](https://developers.google.com/web/fundamentals/performance/critical-rendering-path/)
3. 使用http2的server push特性。
4. 首屏显示的内容越多对用户体验越好，很多网站惯用的方式是优先加载loading，这其实也是不太理想的方式。
5. 不重要的资源可以后置，等onload结束之后再加载，采用懒加载也是一个较好的手段。
6. 页面资源大小越少越好，这需要我们在平时开发中养成清理代码的习惯，减少对第三方库的依赖。